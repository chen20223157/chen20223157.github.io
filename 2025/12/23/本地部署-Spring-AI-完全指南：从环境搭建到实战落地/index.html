<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>本地部署 Spring AI 完全指南：从环境搭建到实战落地 | 欢迎来到chen的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="本地部署 Spring AI 完全指南：从环境搭建到实战落地引言：Spring AI 为何值得本地部署？在大模型时代，开发者对 AI 能力的集成需求日益迫切，但 “云端依赖” 和 “数据隐私” 始终是两大痛点。Spring AI 作为 Spring 生态下的官方 AI 框架，不仅延续了 “约定优于配置” 的核心思想，更提供了对主流大模型的统一抽象，让 Java 开发者能以极低成本集成 AI 能力。">
<meta property="og:type" content="article">
<meta property="og:title" content="本地部署 Spring AI 完全指南：从环境搭建到实战落地">
<meta property="og:url" content="http://example.com/2025/12/23/%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2-Spring-AI-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%EF%BC%9A%E4%BB%8E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%88%B0%E5%AE%9E%E6%88%98%E8%90%BD%E5%9C%B0/index.html">
<meta property="og:site_name" content="欢迎来到chen的博客">
<meta property="og:description" content="本地部署 Spring AI 完全指南：从环境搭建到实战落地引言：Spring AI 为何值得本地部署？在大模型时代，开发者对 AI 能力的集成需求日益迫切，但 “云端依赖” 和 “数据隐私” 始终是两大痛点。Spring AI 作为 Spring 生态下的官方 AI 框架，不仅延续了 “约定优于配置” 的核心思想，更提供了对主流大模型的统一抽象，让 Java 开发者能以极低成本集成 AI 能力。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-12-23T11:29:25.000Z">
<meta property="article:modified_time" content="2025-12-24T03:05:26.366Z">
<meta property="article:author" content="little chen">
<meta property="article:tag" content="测试开发,后端开发，测试">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="欢迎来到chen的博客" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 8.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">欢迎来到chen的博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">一个专注于技术分享的博客，详情可访问我的csdn——&gt;id:weixin_73527660</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-本地部署-Spring-AI-完全指南：从环境搭建到实战落地" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/12/23/%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2-Spring-AI-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%EF%BC%9A%E4%BB%8E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%88%B0%E5%AE%9E%E6%88%98%E8%90%BD%E5%9C%B0/" class="article-date">
  <time class="dt-published" datetime="2025-12-23T11:29:25.000Z" itemprop="datePublished">2025-12-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      本地部署 Spring AI 完全指南：从环境搭建到实战落地
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="本地部署-Spring-AI-完全指南：从环境搭建到实战落地"><a href="#本地部署-Spring-AI-完全指南：从环境搭建到实战落地" class="headerlink" title="本地部署 Spring AI 完全指南：从环境搭建到实战落地"></a>本地部署 Spring AI 完全指南：从环境搭建到实战落地</h1><h2 id="引言：Spring-AI-为何值得本地部署？"><a href="#引言：Spring-AI-为何值得本地部署？" class="headerlink" title="引言：Spring AI 为何值得本地部署？"></a>引言：Spring AI 为何值得本地部署？</h2><p>在大模型时代，开发者对 AI 能力的集成需求日益迫切，但 “云端依赖” 和 “数据隐私” 始终是两大痛点。Spring AI 作为 Spring 生态下的官方 AI 框架，不仅延续了 “约定优于配置” 的核心思想，更提供了对主流大模型的统一抽象，让 Java 开发者能以极低成本集成 AI 能力。</p>
<p>而本地部署 Spring AI，正是解决上述痛点的关键方案 —— 它能避免敏感数据传输至第三方云端，降低网络延迟带来的响应损耗，同时让开发者完全掌控模型运行环境，适配私有化部署、内网场景等特殊需求。本文将从环境准备到实战案例，手把手教你完成 Spring AI 的本地部署，覆盖开源模型、闭源 API、向量数据库等核心场景，最终实现一个可落地的本地 AI 应用。</p>
<h2 id="一、本地部署前的基础准备：环境与工具"><a href="#一、本地部署前的基础准备：环境与工具" class="headerlink" title="一、本地部署前的基础准备：环境与工具"></a>一、本地部署前的基础准备：环境与工具</h2><p>在开始部署前，需先完成基础环境配置，确保 Java、Spring 生态工具与模型运行依赖兼容。本节将明确各组件的版本要求与安装步骤，避免后续因环境问题导致部署失败。</p>
<h3 id="1-1-核心环境依赖清单"><a href="#1-1-核心环境依赖清单" class="headerlink" title="1.1 核心环境依赖清单"></a>1.1 核心环境依赖清单</h3><p>Spring AI 的本地部署依赖 Java 生态与模型运行环境，需严格匹配版本兼容性。以下是经过验证的稳定版本组合：</p>
<table>
<thead>
<tr>
<th>组件</th>
<th>推荐版本</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>JDK</td>
<td>17+</td>
<td>Spring AI 基于 Java 17 开发，低版本不兼容</td>
</tr>
<tr>
<td>Spring Boot</td>
<td>3.2.x</td>
<td>需与 Spring AI 版本对应（见下文）</td>
</tr>
<tr>
<td>Spring AI</td>
<td>0.8.1（稳定版）</td>
<td>最新版需查看官方兼容性文档</td>
</tr>
<tr>
<td>构建工具</td>
<td>Maven 3.8+ &#x2F; Gradle 8.0+</td>
<td>推荐 Maven，依赖管理更直观</td>
</tr>
<tr>
<td>模型运行环境</td>
<td>Ollama 0.1.30+ &#x2F; TensorFlow 2.15+</td>
<td>开源模型本地运行核心</td>
</tr>
<tr>
<td>代码编辑器</td>
<td>IntelliJ IDEA 2023+</td>
<td>支持 Spring Boot 自动配置，调试更高效</td>
</tr>
</tbody></table>
<h3 id="1-2-环境安装步骤（Windows-macOS-通用）"><a href="#1-2-环境安装步骤（Windows-macOS-通用）" class="headerlink" title="1.2 环境安装步骤（Windows&#x2F;macOS 通用）"></a>1.2 环境安装步骤（Windows&#x2F;macOS 通用）</h3><h4 id="步骤-1：安装-JDK-17"><a href="#步骤-1：安装-JDK-17" class="headerlink" title="步骤 1：安装 JDK 17"></a>步骤 1：安装 JDK 17</h4><ol>
<li>从<a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/downloads/#java17">Oracle 官网</a>或<a target="_blank" rel="noopener" href="https://adoptium.net/">Adoptium</a>下载 JDK 17（推荐 Adoptium 的 OpenJDK，无需注册）；</li>
<li>配置环境变量： <ul>
<li>Windows：右键 “此电脑”→“属性”→“高级系统设置”→“环境变量”，新增<code>JAVA_HOME</code>指向 JDK 安装目录，在<code>Path</code>中添加<code>%JAVA_HOME%\bin</code>；</li>
<li>macOS：打开终端，执行<code>echo &#39;export JAVA_HOME=$(/usr/libexec/java_home -v 17)&#39; &gt;&gt; ~/.zshrc</code>（若用 bash 则改<code>.bash_profile</code>），执行<code>source ~/.zshrc</code>生效；</li>
</ul>
</li>
<li>验证：终端输入<code>java -version</code>，输出 “openjdk version “17.x.x”” 即成功。</li>
</ol>
<h4 id="步骤-2：安装-Maven-3-8"><a href="#步骤-2：安装-Maven-3-8" class="headerlink" title="步骤 2：安装 Maven 3.8+"></a>步骤 2：安装 Maven 3.8+</h4><ol>
<li>从<a target="_blank" rel="noopener" href="https://maven.apache.org/download.cgi">Maven 官网</a>下载 Binary zip 包；</li>
<li>配置环境变量： <ul>
<li>Windows：新增<code>MAVEN_HOME</code>指向解压目录，<code>Path</code>添加<code>%MAVEN_HOME%\bin</code>；</li>
<li>macOS：执行<code>echo &#39;export MAVEN_HOME=/你的解压路径/apache-maven-3.8.8&#39; &gt;&gt; ~/.zshrc</code>，再执行<code>source ~/.zshrc</code>；</li>
</ul>
</li>
<li>验证：终端输入<code>mvn -v</code>，输出 Maven 版本与 Java 路径即成功。</li>
</ol>
<h4 id="步骤-3：安装模型运行环境（以-Ollama-为例）"><a href="#步骤-3：安装模型运行环境（以-Ollama-为例）" class="headerlink" title="步骤 3：安装模型运行环境（以 Ollama 为例）"></a>步骤 3：安装模型运行环境（以 Ollama 为例）</h4><p>Ollama 是轻量级开源模型运行工具，支持 Llama 2、Mistral、ChatGLM 等主流模型，本地部署首选：</p>
<ol>
<li>从<a target="_blank" rel="noopener" href="https://ollama.com/">Ollama 官网</a>下载对应系统客户端（Windows&#x2F;macOS&#x2F;Linux）；</li>
<li>安装后启动 Ollama，终端执行<code>ollama pull llama2:7b</code>（拉取 7B 参数的 Llama 2 模型，约 4GB，需耐心等待）；</li>
<li>验证：执行<code>ollama run llama2:7b</code>，输入 “Hello” 若能收到回复，说明模型运行正常。</li>
</ol>
<h2 id="二、Spring-AI-核心概念：理解部署的-“底层逻辑”"><a href="#二、Spring-AI-核心概念：理解部署的-“底层逻辑”" class="headerlink" title="二、Spring AI 核心概念：理解部署的 “底层逻辑”"></a>二、Spring AI 核心概念：理解部署的 “底层逻辑”</h2><p>在动手部署前，需先掌握 Spring AI 的核心抽象 —— 这些设计是 “统一适配所有模型” 的关键，也是后续解决问题的基础。本节将用通俗的语言解释核心组件，避免陷入源码细节，聚焦 “部署相关” 的知识点。</p>
<h3 id="2-1-三大核心抽象：适配所有模型的-“通用接口”"><a href="#2-1-三大核心抽象：适配所有模型的-“通用接口”" class="headerlink" title="2.1 三大核心抽象：适配所有模型的 “通用接口”"></a>2.1 三大核心抽象：适配所有模型的 “通用接口”</h3><p>Spring AI 通过 3 个核心接口，屏蔽了不同模型（如 OpenAI、Llama 2、ChatGLM）的调用差异，让开发者无需修改代码即可切换模型。</p>
<h4 id="1-Prompt：“给模型的指令”-封装"><a href="#1-Prompt：“给模型的指令”-封装" class="headerlink" title="1. Prompt：“给模型的指令” 封装"></a>1. Prompt：“给模型的指令” 封装</h4><p>Prompt 是开发者传递给模型的 “指令 + 上下文”，包含两个核心部分：</p>
<ul>
<li><strong>UserMessage</strong>：用户的核心需求（如 “写一篇 Java 教程”）；</li>
<li><strong>SystemMessage</strong>：对模型的约束（如 “用 Markdown 格式，字数 500 字以内”）。</li>
</ul>
<p>Spring AI 提供<code>PromptTemplate</code>工具，支持动态填充参数，例如：</p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 定义Prompt模板，&#123;topic&#125;为动态参数</span><br><span class="line">PromptTemplate promptTemplate = PromptTemplate.from(&quot;写一篇关于&#123;topic&#125;的技术短文，300字以内&quot;);</span><br><span class="line">// 填充参数</span><br><span class="line">Map&lt;String, Object&gt; params = new HashMap&lt;&gt;();</span><br><span class="line">params.put(&quot;topic&quot;, &quot;Spring AI本地部署&quot;);</span><br><span class="line">// 生成最终Prompt</span><br><span class="line">Prompt prompt = promptTemplate.create(params);</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h4 id="2-Model：“模型调用”-的统一入口"><a href="#2-Model：“模型调用”-的统一入口" class="headerlink" title="2. Model：“模型调用” 的统一入口"></a>2. Model：“模型调用” 的统一入口</h4><p>Model 是 Spring AI 调用模型的核心接口，分为两类：</p>
<ul>
<li><strong>ChatModel</strong>：用于对话模型（如 Llama 2、GPT-3.5），返回<code>ChatResponse</code>（包含多轮对话历史）；</li>
<li><strong>EmbeddingModel</strong>：用于生成文本向量（如将 “猫” 转化为数组），主要用于向量数据库检索。</li>
</ul>
<p>本地部署时，我们主要使用<code>ChatModel</code>，且无需关心模型是 “本地开源” 还是 “云端 API”—— 只需配置对应的实现类（如<code>OllamaChatModel</code>、<code>OpenAiChatModel</code>）。</p>
<h4 id="3-OutputParser：“模型输出”-的格式化工具"><a href="#3-OutputParser：“模型输出”-的格式化工具" class="headerlink" title="3. OutputParser：“模型输出” 的格式化工具"></a>3. OutputParser：“模型输出” 的格式化工具</h4><p>模型返回的原始输出是字符串（如 Llama 2 返回的 Markdown 文本），<code>OutputParser</code>用于将其转化为结构化数据（如 Java 对象、List）。</p>
<p>例如，若模型返回 “姓名：张三，年龄：25”，可通过<code>BeanOutputParser</code>直接解析为<code>User</code>对象：</p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 定义User类</span><br><span class="line">class User &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private Integer age;</span><br><span class="line">    // getter/setter省略</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 创建解析器</span><br><span class="line">BeanOutputParser&lt;User&gt; parser = new BeanOutputParser&lt;&gt;(User.class);</span><br><span class="line">// 向模型传递解析规则（通过SystemMessage）</span><br><span class="line">String systemPrompt = &quot;按以下格式返回JSON：&#123;\&quot;name\&quot;:\&quot;\&quot;,\&quot;age\&quot;:0&#125;，不要多余内容&quot;;</span><br><span class="line">Prompt prompt = new Prompt(List.of(</span><br><span class="line">    new SystemMessage(systemPrompt),</span><br><span class="line">    new UserMessage(&quot;描述一个叫张三的人，年龄25岁&quot;)</span><br><span class="line">));</span><br><span class="line">// 调用模型并解析</span><br><span class="line">ChatResponse response = chatModel.call(prompt);</span><br><span class="line">User user = parser.parse(response.getResult().getOutput().getContent());</span><br><span class="line">// 输出：name=张三，age=25</span><br><span class="line">System.out.println(&quot;name=&quot; + user.getName() + &quot;，age=&quot; + user.getAge());</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h3 id="2-2-本地部署的两种场景：开源模型-vs-闭源-API"><a href="#2-2-本地部署的两种场景：开源模型-vs-闭源-API" class="headerlink" title="2.2 本地部署的两种场景：开源模型 vs 闭源 API"></a>2.2 本地部署的两种场景：开源模型 vs 闭源 API</h3><p>Spring AI 本地部署并非 “只能用开源模型”，而是包含两种核心场景，需根据需求选择：</p>
<table>
<thead>
<tr>
<th>场景</th>
<th>核心特点</th>
<th>适用场景</th>
<th>依赖工具</th>
</tr>
</thead>
<tbody><tr>
<td>本地开源模型部署</td>
<td>模型运行在本地服务器，无网络依赖</td>
<td>数据敏感、内网环境、低延迟需求</td>
<td>Ollama&#x2F;TensorFlow</td>
</tr>
<tr>
<td>本地项目调用闭源 API</td>
<td>项目部署在本地，通过 API 调用云端模型（如 OpenAI）</td>
<td>无需本地硬件资源，模型能力强</td>
<td>API 密钥、网络连接</td>
</tr>
</tbody></table>
<p>本文将重点覆盖 “本地开源模型部署”（最常用、最能体现本地部署价值），同时简要介绍 “本地项目调用闭源 API” 的配置方式。</p>
<h2 id="三、实战-1：Spring-AI-基础项目搭建（调用本地-Ollama-模型）"><a href="#三、实战-1：Spring-AI-基础项目搭建（调用本地-Ollama-模型）" class="headerlink" title="三、实战 1：Spring AI 基础项目搭建（调用本地 Ollama 模型）"></a>三、实战 1：Spring AI 基础项目搭建（调用本地 Ollama 模型）</h2><p>本节将从 0 开始创建 Spring Boot 项目，集成 Spring AI 并调用本地 Ollama 运行的 Llama 2 模型，实现 “发送指令→接收模型回复” 的基础功能。全程代码可复制，确保新手也能快速跑通。</p>
<h3 id="3-1-项目创建（两种方式）"><a href="#3-1-项目创建（两种方式）" class="headerlink" title="3.1 项目创建（两种方式）"></a>3.1 项目创建（两种方式）</h3><h4 id="方式-1：通过-Spring-Initializr（推荐）"><a href="#方式-1：通过-Spring-Initializr（推荐）" class="headerlink" title="方式 1：通过 Spring Initializr（推荐）"></a>方式 1：通过 Spring Initializr（推荐）</h4><ol>
<li>打开<a target="_blank" rel="noopener" href="https://start.spring.io/">Spring Initializr</a>；</li>
<li>配置项目信息： <ul>
<li>Project：Maven Project；</li>
<li>Language：Java；</li>
<li>Spring Boot：3.2.5（稳定版）；</li>
<li>Group&#x2F;Artifact：自定义（如 com.example&#x2F;spring-ai-demo）；</li>
<li>Dependencies：搜索并添加 “Spring Web”（用于后续创建接口）；</li>
</ul>
</li>
<li>点击 “Generate” 下载项目压缩包，解压后用 IDEA 打开。</li>
</ol>
<h4 id="方式-2：手动创建-Maven-项目"><a href="#方式-2：手动创建-Maven-项目" class="headerlink" title="方式 2：手动创建 Maven 项目"></a>方式 2：手动创建 Maven 项目</h4><p>若 Initializr 无法访问，可手动创建<code>pom.xml</code>，复制以下内容：</p>
<p>xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;3.2.5&lt;/version&gt;</span><br><span class="line">        &lt;relativePath/&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.example&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-ai-demo&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;name&gt;spring-ai-demo&lt;/name&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!-- Spring Web：用于创建HTTP接口 --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- Spring AI核心依赖 --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-ai-core&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;0.8.1&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- Spring AI Ollama集成：调用本地Ollama模型 --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-ai-ollama&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;0.8.1&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- 测试依赖 --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h3 id="3-2-配置本地-Ollama-模型"><a href="#3-2-配置本地-Ollama-模型" class="headerlink" title="3.2 配置本地 Ollama 模型"></a>3.2 配置本地 Ollama 模型</h3><p>打开<code>src/main/resources/application.properties</code>（或<code>application.yml</code>），添加 Ollama 配置：</p>
<p>properties</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Ollama服务地址（默认本地地址，无需修改）</span><br><span class="line">spring.ai.ollama.base-url=http://localhost:11434</span><br><span class="line"># 调用的模型名称（需与Ollama拉取的模型一致，如llama2:7b）</span><br><span class="line">spring.ai.ollama.chat.model=llama2:7b</span><br><span class="line"># 模型温度（0-1，值越高回复越随机，0更稳定）</span><br><span class="line">spring.ai.ollama.chat.temperature=0.7</span><br><span class="line"># 最大生成字数</span><br><span class="line">spring.ai.ollama.chat.max-tokens=2048</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>关键说明：</p>
<ul>
<li><code>base-url</code>：Ollama 默认端口是 11434，若修改过 Ollama 配置需同步调整；</li>
<li><code>model</code>：必须与<code>ollama pull</code>的模型名一致（可通过<code>ollama list</code>查看本地模型）；</li>
<li><code>temperature</code>：本地模型推荐设 0.5-0.7，平衡稳定性与灵活性。</li>
</ul>
<h3 id="3-3-编写基础调用代码"><a href="#3-3-编写基础调用代码" class="headerlink" title="3.3 编写基础调用代码"></a>3.3 编写基础调用代码</h3><h4 id="步骤-1：创建-AI-服务类（封装模型调用逻辑）"><a href="#步骤-1：创建-AI-服务类（封装模型调用逻辑）" class="headerlink" title="步骤 1：创建 AI 服务类（封装模型调用逻辑）"></a>步骤 1：创建 AI 服务类（封装模型调用逻辑）</h4><p>在<code>com.example.springaidemo.service</code>包下创建<code>AIService</code>类，注入<code>ChatModel</code>（Spring AI 会自动根据配置创建<code>OllamaChatModel</code>实例）：</p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package com.example.springaidemo.service;</span><br><span class="line"></span><br><span class="line">import org.springframework.ai.chat.ChatModel;</span><br><span class="line">import org.springframework.ai.chat.ChatResponse;</span><br><span class="line">import org.springframework.ai.chat.prompt.Prompt;</span><br><span class="line">import org.springframework.ai.chat.prompt.PromptTemplate;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class AIService &#123;</span><br><span class="line"></span><br><span class="line">    // 注入ChatModel（自动适配Ollama）</span><br><span class="line">    private final ChatModel chatModel;</span><br><span class="line"></span><br><span class="line">    // 构造函数注入</span><br><span class="line">    public AIService(ChatModel chatModel) &#123;</span><br><span class="line">        this.chatModel = chatModel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 基础文本生成方法：接收主题，返回短文</span><br><span class="line">    public String generateShortArticle(String topic) &#123;</span><br><span class="line">        // 1. 定义Prompt模板</span><br><span class="line">        String promptTemplate = &quot;&quot;&quot;</span><br><span class="line">                请写一篇关于&#123;topic&#125;的技术短文，要求：</span><br><span class="line">                1. 字数300字以内；</span><br><span class="line">                2. 分2-3个小点；</span><br><span class="line">                3. 语言通俗易懂，适合Java开发者。</span><br><span class="line">                &quot;&quot;&quot;;</span><br><span class="line">        // 2. 填充动态参数</span><br><span class="line">        Map&lt;String, Object&gt; params = new HashMap&lt;&gt;();</span><br><span class="line">        params.put(&quot;topic&quot;, topic);</span><br><span class="line">        Prompt prompt = PromptTemplate.from(promptTemplate).create(params);</span><br><span class="line">        </span><br><span class="line">        // 3. 调用模型并返回结果</span><br><span class="line">        ChatResponse response = chatModel.call(prompt);</span><br><span class="line">        return response.getResult().getOutput().getContent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h4 id="步骤-2：创建-HTTP-接口（供外部调用）"><a href="#步骤-2：创建-HTTP-接口（供外部调用）" class="headerlink" title="步骤 2：创建 HTTP 接口（供外部调用）"></a>步骤 2：创建 HTTP 接口（供外部调用）</h4><p>在<code>com.example.springaidemo.controller</code>包下创建<code>AIController</code>类，提供 GET 接口：</p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">package com.example.springaidemo.controller;</span><br><span class="line"></span><br><span class="line">import com.example.springaidemo.service.AIService;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">public class AIController &#123;</span><br><span class="line"></span><br><span class="line">    private final AIService aiService;</span><br><span class="line"></span><br><span class="line">    public AIController(AIService aiService) &#123;</span><br><span class="line">        this.aiService = aiService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 接口：/api/generate?topic=xxx</span><br><span class="line">    @GetMapping(&quot;/api/generate&quot;)</span><br><span class="line">    public String generateArticle(@RequestParam String topic) &#123;</span><br><span class="line">        // 调用服务类方法</span><br><span class="line">        return aiService.generateShortArticle(topic);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h4 id="步骤-3：启动项目并测试"><a href="#步骤-3：启动项目并测试" class="headerlink" title="步骤 3：启动项目并测试"></a>步骤 3：启动项目并测试</h4><ol>
<li>运行<code>SpringAiDemoApplication</code>类（主类）；</li>
<li>打开浏览器或 Postman，访问：<code>http://localhost:8080/api/generate?topic=Spring AI本地部署</code>；</li>
<li>等待 3-10 秒（本地模型响应较慢，取决于硬件），即可收到类似以下的回复：</li>
</ol>
<p>plaintext</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">### 1. 环境准备是基础</span><br><span class="line">本地部署Spring AI需先搭好环境：JDK 17+保证兼容，Ollama工具用来运行开源模型（如Llama 2），还要注意Spring Boot版本与Spring AI匹配（推荐3.2.x+0.8.1）。</span><br><span class="line"></span><br><span class="line">### 2. 配置简化调用流程</span><br><span class="line">在application.properties中填Ollama地址（默认localhost:11434）和模型名，Spring AI会自动创建ChatModel实例，无需手动写调用逻辑，开发者只需注入即可用。</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>至此，基础的 Spring AI 本地部署已完成 —— 项目运行在本地，调用本地 Ollama 的 Llama 2 模型，全程无外部网络依赖（除模型下载阶段）。</p>
<h2 id="四、实战-2：本地部署开源模型进阶（ChatGLM3-向量数据库）"><a href="#四、实战-2：本地部署开源模型进阶（ChatGLM3-向量数据库）" class="headerlink" title="四、实战 2：本地部署开源模型进阶（ChatGLM3 + 向量数据库）"></a>四、实战 2：本地部署开源模型进阶（ChatGLM3 + 向量数据库）</h2><p>上一节的基础案例仅实现了 “文本生成”，本节将进阶到 “本地化知识库” 场景 —— 结合 ChatGLM3（国产开源模型）与 Milvus（本地向量数据库），实现 “基于本地文档的问答”（如上传 Java 手册，让模型回答手册中的问题）。</p>
<h3 id="4-1-场景需求与技术选型"><a href="#4-1-场景需求与技术选型" class="headerlink" title="4.1 场景需求与技术选型"></a>4.1 场景需求与技术选型</h3><h4 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h4><ul>
<li>上传本地 PDF 文档（如《Spring Boot 官方手册》）；</li>
<li>模型能 “读懂” 文档内容，回答相关问题（如 “Spring Boot 如何配置数据源”）；</li>
<li>所有数据（文档、向量、模型）均运行在本地，不泄露至外部。</li>
</ul>
<h4 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h4><ul>
<li><strong>模型</strong>：ChatGLM3-6B（国产开源，中文支持好，6B 参数适合本地部署）；</li>
<li><strong>向量数据库</strong>：Milvus Lite（轻量级本地向量数据库，无需单独部署服务）；</li>
<li><strong>文档解析</strong>：Spring AI 的<code>PdfDocumentReader</code>（解析 PDF 为文本）；</li>
<li><strong>Embedding 模型</strong>：<code>BgeSmallEnEmbeddingModel</code>（轻量级文本向量生成模型）。</li>
</ul>
<h3 id="4-2-环境准备（新增组件）"><a href="#4-2-环境准备（新增组件）" class="headerlink" title="4.2 环境准备（新增组件）"></a>4.2 环境准备（新增组件）</h3><h4 id="步骤-1：下载-ChatGLM3-6B-模型"><a href="#步骤-1：下载-ChatGLM3-6B-模型" class="headerlink" title="步骤 1：下载 ChatGLM3-6B 模型"></a>步骤 1：下载 ChatGLM3-6B 模型</h4><ol>
<li>访问<a target="_blank" rel="noopener" href="https://huggingface.co/THUDM/chatglm3-6b">Hugging Face ChatGLM3 页面</a>；</li>
<li>下载模型文件（需注册账号，推荐用 Git LFS：<code>git lfs clone https://huggingface.co/THUDM/chatglm3-6b</code>）；</li>
<li>将模型文件放入本地目录（如<code>D:/models/chatglm3-6b</code>）。</li>
</ol>
<h4 id="步骤-2：集成-Milvus-Lite"><a href="#步骤-2：集成-Milvus-Lite" class="headerlink" title="步骤 2：集成 Milvus Lite"></a>步骤 2：集成 Milvus Lite</h4><p>Milvus Lite 无需单独部署，只需在<code>pom.xml</code>中添加依赖：</p>
<p>xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Milvus Lite：本地向量数据库 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.milvus&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;milvus-sdk-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.4.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- Spring AI文档解析：支持PDF/Word --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-ai-document-reader&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.8.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- Embedding模型：生成文本向量 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-ai-huggingface-embeddings&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.8.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h3 id="4-3-核心功能实现（本地化知识库）"><a href="#4-3-核心功能实现（本地化知识库）" class="headerlink" title="4.3 核心功能实现（本地化知识库）"></a>4.3 核心功能实现（本地化知识库）</h3><h4 id="步骤-1：配置-ChatGLM3-与-Embedding-模型"><a href="#步骤-1：配置-ChatGLM3-与-Embedding-模型" class="headerlink" title="步骤 1：配置 ChatGLM3 与 Embedding 模型"></a>步骤 1：配置 ChatGLM3 与 Embedding 模型</h4><p>修改<code>application.properties</code>，添加以下配置：</p>
<p>properties</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 1. ChatGLM3模型配置（本地文件）</span><br><span class="line">spring.ai.huggingface.chat.model=THUDM/chatglm3-6b</span><br><span class="line">spring.ai.huggingface.chat.model-path=D:/models/chatglm3-6b  # 本地模型路径</span><br><span class="line">spring.ai.huggingface.chat.temperature=0.5</span><br><span class="line"></span><br><span class="line"># 2. Embedding模型配置（生成文本向量）</span><br><span class="line">spring.ai.huggingface.embedding.model=BAAI/bge-small-en-v1.5</span><br><span class="line">spring.ai.huggingface.embedding.model-path=D:/models/bge-small-en-v1.5  # 需提前下载</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>说明：Bge-small-en 模型需从<a target="_blank" rel="noopener" href="https://huggingface.co/BAAI/bge-small-en-v1.5">Hugging Face</a>下载，约 1GB，中文支持良好。</p>
<h4 id="步骤-2：实现文档上传与向量存储"><a href="#步骤-2：实现文档上传与向量存储" class="headerlink" title="步骤 2：实现文档上传与向量存储"></a>步骤 2：实现文档上传与向量存储</h4><p>创建<code>DocumentService</code>类，负责解析 PDF 文档、生成向量并存储到 Milvus：</p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">package com.example.springaidemo.service;</span><br><span class="line"></span><br><span class="line">import org.springframework.ai.document.Document;</span><br><span class="line">import org.springframework.ai.document.DocumentReader;</span><br><span class="line">import org.springframework.ai.document.reader.pdf.PdfDocumentReader;</span><br><span class="line">import org.springframework.ai.embedding.EmbeddingModel;</span><br><span class="line">import org.springframework.ai.embedding.EmbeddingResponse;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import io.milvus.client.MilvusClient;</span><br><span class="line">import io.milvus.client.MilvusServiceClient;</span><br><span class="line">import io.milvus.param.ConnectParam;</span><br><span class="line">import io.milvus.param.collection.CreateCollectionParam;</span><br><span class="line">import io.milvus.param.collection.FieldType;</span><br><span class="line">import io.milvus.param.dml.InsertParam;</span><br><span class="line">import io.milvus.response.InsertResponse;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class DocumentService &#123;</span><br><span class="line"></span><br><span class="line">    // 向量维度（Bge-small-en模型生成的向量是384维）</span><br><span class="line">    private static final int VECTOR_DIM = 384;</span><br><span class="line">    // Milvus集合名（类似数据库表名）</span><br><span class="line">    private static final String COLLECTION_NAME = &quot;local_knowledge&quot;;</span><br><span class="line"></span><br><span class="line">    private final EmbeddingModel embeddingModel;</span><br><span class="line">    private final MilvusClient milvusClient;</span><br><span class="line"></span><br><span class="line">    // 构造函数：初始化Milvus客户端</span><br><span class="line">    public DocumentService(EmbeddingModel embeddingModel) &#123;</span><br><span class="line">        this.embeddingModel = embeddingModel;</span><br><span class="line">        // 初始化Milvus Lite（本地内存模式，无需服务）</span><br><span class="line">        this.milvusClient = new MilvusServiceClient(</span><br><span class="line">                ConnectParam.newBuilder()</span><br><span class="line">                        .withUri(&quot;http://localhost:19530&quot;)  // Milvus默认端口</span><br><span class="line">                        .build()</span><br><span class="line">        );</span><br><span class="line">        // 创建集合（若不存在）</span><br><span class="line">        createCollectionIfNotExists();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 创建Milvus集合（包含id、text、vector三个字段）</span><br><span class="line">    private void createCollectionIfNotExists() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            // 定义字段</span><br><span class="line">            List&lt;FieldType&gt; fields = new ArrayList&lt;&gt;();</span><br><span class="line">            // id：主键</span><br><span class="line">            fields.add(FieldType.newBuilder()</span><br><span class="line">                    .withName(&quot;id&quot;)</span><br><span class="line">                    .withDataType(FieldType.DataType.Int64)</span><br><span class="line">                    .withPrimaryKey(true)</span><br><span class="line">                    .withAutoID(true)</span><br><span class="line">                    .build());</span><br><span class="line">            // text：文档内容</span><br><span class="line">            fields.add(FieldType.newBuilder()</span><br><span class="line">                    .withName(&quot;text&quot;)</span><br><span class="line">                    .withDataType(FieldType.DataType.VarChar)</span><br><span class="line">                    .withMaxLength(2000)</span><br><span class="line">                    .build());</span><br><span class="line">            // vector：文本向量</span><br><span class="line">            fields.add(FieldType.newBuilder()</span><br><span class="line">                    .withName(&quot;vector&quot;)</span><br><span class="line">                    .withDataType(FieldType.DataType.FloatVector)</span><br><span class="line">                    .withDimension(VECTOR_DIM)</span><br><span class="line">                    .build());</span><br><span class="line"></span><br><span class="line">            // 创建集合</span><br><span class="line">            milvusClient.createCollection(</span><br><span class="line">                    CreateCollectionParam.newBuilder()</span><br><span class="line">                            .withCollectionName(COLLECTION_NAME)</span><br><span class="line">                            .withFieldTypes(fields)</span><br><span class="line">                            .build()</span><br><span class="line">            );</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            // 若集合已存在，忽略异常</span><br><span class="line">            System.out.println(&quot;Milvus集合已存在：&quot; + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 上传PDF文档：解析→生成向量→存储到Milvus</span><br><span class="line">    public String uploadPdf(File pdfFile) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            // 1. 解析PDF为Document列表（每页一个Document）</span><br><span class="line">            DocumentReader reader = new PdfDocumentReader(pdfFile);</span><br><span class="line">            List&lt;Document&gt; documents = reader.read();</span><br><span class="line"></span><br><span class="line">            // 2. 批量生成向量（对每个Document的内容生成向量）</span><br><span class="line">            List&lt;String&gt; texts = documents.stream()</span><br><span class="line">                    .map(Document::getContent)</span><br><span class="line">                    .toList();</span><br><span class="line">            EmbeddingResponse embeddingResponse = embeddingModel.embed(texts);</span><br><span class="line">            List&lt;List&lt;Float&gt;&gt; vectors = embeddingResponse.getResult().getEmbeddings();</span><br><span class="line"></span><br><span class="line">            // 3. 存储到Milvus</span><br><span class="line">            List&lt;InsertParam.Field&gt; insertFields = new ArrayList&lt;&gt;();</span><br><span class="line">            insertFields.add(new InsertParam.Field(&quot;text&quot;, texts));</span><br><span class="line">            insertFields.add(new InsertParam.Field(&quot;vector&quot;, vectors));</span><br><span class="line"></span><br><span class="line">            InsertResponse response = milvusClient.insert(</span><br><span class="line">                    InsertParam.newBuilder()</span><br><span class="line">                            .withCollectionName(COLLECTION_NAME)</span><br><span class="line">                            .withFields(insertFields)</span><br><span class="line">                            .build()</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            return &quot;上传成功！处理文档页数：&quot; + documents.size() + &quot;，插入Milvus条数：&quot; + response.getInsertCount();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            return &quot;上传失败：&quot; + e.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h4 id="步骤-3：实现-“基于知识库的问答”"><a href="#步骤-3：实现-“基于知识库的问答”" class="headerlink" title="步骤 3：实现 “基于知识库的问答”"></a>步骤 3：实现 “基于知识库的问答”</h4><p>修改<code>AIService</code>类，添加<code>queryWithKnowledge</code>方法，逻辑为：</p>
<ol>
<li>将用户问题生成向量；</li>
<li>在 Milvus 中检索相似向量对应的文档内容；</li>
<li>将 “相似文档 + 用户问题” 作为 Prompt 传给 ChatGLM3，生成回答。</li>
</ol>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">// 在AIService中注入DocumentService和MilvusClient</span><br><span class="line">private final DocumentService documentService;</span><br><span class="line">private final MilvusClient milvusClient;</span><br><span class="line"></span><br><span class="line">// 构造函数新增注入</span><br><span class="line">public AIService(ChatModel chatModel, DocumentService documentService, MilvusClient milvusClient) &#123;</span><br><span class="line">    this.chatModel = chatModel;</span><br><span class="line">    this.documentService = documentService;</span><br><span class="line">    this.milvusClient = milvusClient;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 基于知识库的问答方法</span><br><span class="line">public String queryWithKnowledge(String userQuestion) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        // 1. 将用户问题生成向量</span><br><span class="line">        EmbeddingResponse questionEmbedding = embeddingModel.embed(List.of(userQuestion));</span><br><span class="line">        List&lt;Float&gt; questionVector = questionEmbedding.getResult().getEmbeddings().get(0);</span><br><span class="line"></span><br><span class="line">        // 2. 在Milvus中检索Top3相似文档</span><br><span class="line">        String searchExpr = &quot;text != &#x27;&#x27;&quot;;</span><br><span class="line">        io.milvus.param.search.SearchParam searchParam = io.milvus.param.search.SearchParam.newBuilder()</span><br><span class="line">                .withCollectionName(DocumentService.COLLECTION_NAME)</span><br><span class="line">                .withVectorFieldName(&quot;vector&quot;)</span><br><span class="line">                .withQueryVectors(List.of(questionVector))</span><br><span class="line">                .withTopK(3)</span><br><span class="line">                .withMetricType(io.milvus.param.MetricType.L2)  // 欧氏距离，越小越相似</span><br><span class="line">                .withExpr(searchExpr)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        io.milvus.response.SearchResponse searchResponse = milvusClient.search(searchParam);</span><br><span class="line">        List&lt;String&gt; similarTexts = new ArrayList&lt;&gt;();</span><br><span class="line">        for (var hit : searchResponse.getResults().getHitsList().get(0).getHits()) &#123;</span><br><span class="line">            // 提取相似文档的text字段</span><br><span class="line">            String text = hit.getEntity().getField(&quot;text&quot;).toString();</span><br><span class="line">            similarTexts.add(text);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 3. 构造包含知识库的Prompt</span><br><span class="line">        String promptTemplate = &quot;&quot;&quot;</span><br><span class="line">                基于以下参考文档回答用户问题，若文档中无相关信息，直接说“无法从参考文档中找到答案”：</span><br><span class="line">                参考文档：</span><br><span class="line">                &#123;similarTexts&#125;</span><br><span class="line">                </span><br><span class="line">                用户问题：&#123;userQuestion&#125;</span><br><span class="line">                &quot;&quot;&quot;;</span><br><span class="line">        Map&lt;String, Object&gt; params = new HashMap&lt;&gt;();</span><br><span class="line">        params.put(&quot;similarTexts&quot;, String.join(&quot;\n---\n&quot;, similarTexts));</span><br><span class="line">        params.put(&quot;userQuestion&quot;, userQuestion);</span><br><span class="line">        Prompt prompt = PromptTemplate.from(promptTemplate).create(params);</span><br><span class="line"></span><br><span class="line">        // 4. 调用ChatGLM3生成回答</span><br><span class="line">        ChatResponse response = chatModel.call(prompt);</span><br><span class="line">        return response.getResult().getOutput().getContent();</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        return &quot;问答失败：&quot; + e.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h4 id="步骤-4：添加文件上传与问答接口"><a href="#步骤-4：添加文件上传与问答接口" class="headerlink" title="步骤 4：添加文件上传与问答接口"></a>步骤 4：添加文件上传与问答接口</h4><p>在<code>AIController</code>中添加接口，支持 PDF 上传和知识库问答：</p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestPart;</span><br><span class="line">import org.springframework.web.multipart.MultipartFile;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line"></span><br><span class="line">// PDF上传接口</span><br><span class="line">@PostMapping(&quot;/api/upload/pdf&quot;)</span><br><span class="line">public String uploadPdf(@RequestPart MultipartFile file) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        // 将MultipartFile转为本地File</span><br><span class="line">        File tempFile = File.createTempFile(&quot;temp&quot;, &quot;.pdf&quot;);</span><br><span class="line">        try (FileOutputStream fos = new FileOutputStream(tempFile)) &#123;</span><br><span class="line">            fos.write(file.getBytes());</span><br><span class="line">        &#125;</span><br><span class="line">        // 调用DocumentService上传</span><br><span class="line">        return documentService.uploadPdf(tempFile);</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        return &quot;上传失败：&quot; + e.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 知识库问答接口</span><br><span class="line">@GetMapping(&quot;/api/query&quot;)</span><br><span class="line">public String queryKnowledge(@RequestParam String question) &#123;</span><br><span class="line">    return aiService.queryWithKnowledge(question);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h3 id="4-4-测试本地化知识库"><a href="#4-4-测试本地化知识库" class="headerlink" title="4.4 测试本地化知识库"></a>4.4 测试本地化知识库</h3><ol>
<li>启动项目，用 Postman 上传 PDF 文档：<ul>
<li>请求方式：POST；</li>
<li>URL：<code>http://localhost:8080/api/upload/pdf</code>；</li>
<li>参数：<code>file</code>（选择本地 PDF 文件，如《Spring Boot 手册》）；</li>
<li>响应：若显示 “上传成功！处理文档页数：10，插入 Milvus 条数：10”，说明存储正常。</li>
</ul>
</li>
<li>调用问答接口：<ul>
<li>URL：<code>http://localhost:8080/api/query?question=Spring Boot如何配置MySQL数据源</code>；</li>
<li>响应：模型会基于上传的 PDF 内容回答，例如：</li>
</ul>
</li>
</ol>
<p>plaintext</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">根据参考文档，Spring Boot配置MySQL数据源步骤如下：</span><br><span class="line">1. 在pom.xml中添加MySQL依赖（mysql-connector-java）；</span><br><span class="line">2. 在application.properties中配置url、用户名、密码：</span><br><span class="line">   spring.datasource.url=jdbc:mysql://localhost:3306/test</span><br><span class="line">   spring.datasource.username=root</span><br><span class="line">   spring.datasource.password=123456</span><br><span class="line">3. 若使用JPA，需添加spring.jpa.hibernate.ddl-auto=update配置。</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<p>至此，进阶版的 Spring AI 本地部署已完成 —— 实现了 “本地化知识库 + 本地化模型” 的全链路闭环，可应用于企业内部文档问答、私有化客服等场景。</p>
<h2 id="五、本地部署常见问题与优化方案"><a href="#五、本地部署常见问题与优化方案" class="headerlink" title="五、本地部署常见问题与优化方案"></a>五、本地部署常见问题与优化方案</h2><p>在实际部署过程中，开发者常会遇到 “模型启动慢”“内存不足”“响应超时” 等问题。本节将汇总高频问题，提供可落地的解决方案，帮助你稳定运行本地 Spring AI 应用。</p>
<h3 id="5-1-高频问题解决方案"><a href="#5-1-高频问题解决方案" class="headerlink" title="5.1 高频问题解决方案"></a>5.1 高频问题解决方案</h3><h4 id="问题-1：Ollama-启动模型时报-“内存不足”"><a href="#问题-1：Ollama-启动模型时报-“内存不足”" class="headerlink" title="问题 1：Ollama 启动模型时报 “内存不足”"></a>问题 1：Ollama 启动模型时报 “内存不足”</h4><ul>
<li><p><strong>现象</strong>：执行<code>ollama run llama2:7b</code>时，终端提示 “out of memory”；</p>
</li>
<li><p><strong>原因</strong>：7B 模型需至少 8GB 内存，13B 模型需 16GB 以上，内存不足会导致模型启动失败；</p>
</li>
<li><p>解决方案</p>
<p>： </p>
<ol>
<li>降低模型参数：改用更小的模型（如<code>llama2:3b</code>，仅需 4GB 内存）；</li>
<li>启用 Swap 分区（Linux&#x2F;macOS）：通过<code>sudo fallocate -l 8G /swapfile</code>创建 8GB 交换分区，缓解内存压力；</li>
<li>关闭其他应用：关闭 IDE、浏览器等内存占用高的程序，优先保障模型运行。</li>
</ol>
</li>
</ul>
<h4 id="问题-2：Spring-AI-调用模型时报-“连接超时”"><a href="#问题-2：Spring-AI-调用模型时报-“连接超时”" class="headerlink" title="问题 2：Spring AI 调用模型时报 “连接超时”"></a>问题 2：Spring AI 调用模型时报 “连接超时”</h4><ul>
<li><p><strong>现象</strong>：访问<code>/api/generate</code>接口时，报错 “Connection timed out: connect”；</p>
</li>
<li><p><strong>原因</strong>：Ollama 服务未启动，或 Spring AI 配置的<code>base-url</code>错误；</p>
</li>
<li><p>解决方案</p>
<p>： </p>
<ol>
<li>检查 Ollama 服务：执行<code>ollama ps</code>，若显示 “no models running”，需先执行<code>ollama run 模型名</code>启动服务；</li>
<li>验证地址：浏览器访问<code>http://localhost:11434</code>，若显示 “Ollama API”，说明地址正常；</li>
<li>调整超时配置：在<code>application.properties</code>中添加<code>spring.ai.ollama.chat.timeout=30000</code>（30 秒超时，默认 10 秒）。</li>
</ol>
</li>
</ul>
<h4 id="问题-3：模型回复中文乱码"><a href="#问题-3：模型回复中文乱码" class="headerlink" title="问题 3：模型回复中文乱码"></a>问题 3：模型回复中文乱码</h4><ul>
<li><p><strong>现象</strong>：模型返回的中文是 “???” 或乱码；</p>
</li>
<li><p><strong>原因</strong>：模型编码不支持 UTF-8，或 Spring AI 解析响应时编码错误；</p>
</li>
<li><p>解决方案</p>
<p>： </p>
<ol>
<li>选择支持中文的模型：优先使用 ChatGLM3、Qwen 等国产模型，Llama 2 需下载中文微调版本；</li>
<li>配置编码：在<code>application.properties</code>中添加<code>spring.http.encoding.force=true</code>，强制 UTF-8 编码；</li>
<li>手动转码：在解析响应时添加<code>new String(content.getBytes(&quot;ISO-8859-1&quot;), &quot;UTF-8&quot;)</code>，解决编码不一致问题。</li>
</ol>
</li>
</ul>
<h3 id="5-2-性能优化方案"><a href="#5-2-性能优化方案" class="headerlink" title="5.2 性能优化方案"></a>5.2 性能优化方案</h3><h4 id="1-模型层面：降低运行压力"><a href="#1-模型层面：降低运行压力" class="headerlink" title="1. 模型层面：降低运行压力"></a>1. 模型层面：降低运行压力</h4><ul>
<li><strong>使用量化模型</strong>：下载 4-bit 或 8-bit 量化版本的模型（如 ChatGLM3-6B-Q4_K_M），内存占用减少 50%，响应速度提升 30%；</li>
<li><strong>开启 GPU 加速</strong>：若本地有 NVIDIA 显卡，安装 CUDA（Windows&#x2F;macOS 需对应版本），Ollama 会自动使用 GPU，响应速度提升 2-5 倍；</li>
<li><strong>预热模型</strong>：项目启动时自动调用<code>ollama run 模型名</code>，避免首次请求时模型加载耗时。</li>
</ul>
<h4 id="2-应用层面：减少重复计算"><a href="#2-应用层面：减少重复计算" class="headerlink" title="2. 应用层面：减少重复计算"></a>2. 应用层面：减少重复计算</h4><ul>
<li><p>添加缓存</p>
<p>：用 Spring Cache 缓存高频请求的结果，例如：     </p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Cacheable(value = &quot;aiResponse&quot;, key = &quot;#topic&quot;)</span><br><span class="line">public String generateShortArticle(String topic) &#123;</span><br><span class="line">    // 原有逻辑不变</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
</li>
<li><p>异步调用</p>
<p>：将模型调用改为异步，避免阻塞 HTTP 线程，例如： </p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Async</span><br><span class="line">public CompletableFuture&lt;String&gt; generateAsync(String topic) &#123;</span><br><span class="line">    String result = generateShortArticle(topic);</span><br><span class="line">    return CompletableFuture.completedFuture(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
</li>
<li><p><strong>批量处理</strong>：若需生成多条内容，合并为一个 Prompt 批量调用，减少模型交互次数。</p>
</li>
</ul>
<h4 id="3-硬件层面：合理分配资源"><a href="#3-硬件层面：合理分配资源" class="headerlink" title="3. 硬件层面：合理分配资源"></a>3. 硬件层面：合理分配资源</h4><ul>
<li><strong>CPU 优化</strong>：模型运行时会占用多核心，通过<code>taskset</code>（Linux）或 “任务管理器”（Windows）为 Ollama 分配 2-4 个核心，避免 CPU 资源抢占；</li>
<li><strong>磁盘优化</strong>：将模型文件存储在 SSD 上，模型加载速度比 HDD 快 3-5 倍；</li>
<li><strong>内存优化</strong>：关闭系统休眠、虚拟内存压缩等功能，释放更多物理内存给模型。</li>
</ul>
<h2 id="六、总结与下一步学习方向"><a href="#六、总结与下一步学习方向" class="headerlink" title="六、总结与下一步学习方向"></a>六、总结与下一步学习方向</h2><p>本文从环境准备到实战落地，完整覆盖了 Spring AI 本地部署的核心场景 —— 基础模型调用、本地化知识库搭建，同时提供了问题解决方案与优化思路。通过本地部署，你已掌握了 “数据隐私保护”“无网络依赖”“完全可控” 的 AI 应用开发能力，这在企业私有化部署、内网场景中具有极高的实用价值。</p>
<h3 id="6-1-核心收获回顾"><a href="#6-1-核心收获回顾" class="headerlink" title="6.1 核心收获回顾"></a>6.1 核心收获回顾</h3><ol>
<li><strong>环境适配能力</strong>：掌握了 JDK、Ollama、Milvus 等工具的本地配置，理解了 Spring AI 与各组件的版本兼容逻辑；</li>
<li><strong>核心抽象应用</strong>：能基于 Prompt、Model、OutputParser 开发通用 AI 功能，无需关心底层模型差异；</li>
<li><strong>实战场景落地</strong>：实现了 “文本生成”“知识库问答” 两个核心场景，可直接迁移到实际项目；</li>
<li><strong>问题解决思维</strong>：学会了定位内存不足、连接超时等常见问题，掌握了性能优化的关键手段。</li>
</ol>
<h3 id="6-2-下一步学习方向"><a href="#6-2-下一步学习方向" class="headerlink" title="6.2 下一步学习方向"></a>6.2 下一步学习方向</h3><ol>
<li><strong>深入模型微调</strong>：学习用 LoRA 技术微调本地模型（如基于企业文档微调 ChatGLM3），提升模型对特定领域的理解能力；</li>
<li><strong>分布式部署</strong>：探索 Spring AI 与 Spring Cloud 结合，实现多节点模型负载均衡，支撑高并发请求；</li>
<li><strong>多模态集成</strong>：尝试集成本地图片生成模型（如 Stable Diffusion），实现 “文本生成图片” 的多模态功能；</li>
<li><strong>监控与运维</strong>：学习用 Prometheus+Grafana 监控模型运行状态（如内存占用、响应时间），保障应用稳定运行。</li>
</ol>
<p>Spring AI 作为 Spring 生态的重要延伸，其本地部署能力正在不断完善 —— 未来会有更多开源模型、更简洁的配置、更优的性能支持。希望本文能成为你掌握本地 AI 部署的起点，在私有化 AI 应用开发中持续探索与实践。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/12/23/%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2-Spring-AI-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97%EF%BC%9A%E4%BB%8E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%88%B0%E5%AE%9E%E6%88%98%E8%90%BD%E5%9C%B0/" data-id="cuidygQxNfBJCaU1NoEz8TAVX" data-title="本地部署 Spring AI 完全指南：从环境搭建到实战落地" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2025/12/23/%E5%AE%9E%E6%B5%8B-ChatGPT-Code-%E6%96%B0%E6%80%A7%E8%83%BD%EF%BC%9A%E4%BB%8E%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%88%B0%E9%A1%B9%E7%9B%AE%E8%90%BD%E5%9C%B0%EF%BC%8CAI-%E7%BC%96%E7%A8%8B%E7%9A%84%E7%94%9F%E4%BA%A7%E5%8A%9B%E9%9D%A9%E5%91%BD%E5%B7%B2%E6%9D%A5/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          实测 ChatGPT-Code 新性能：从代码生成到项目落地，AI 编程的生产力革命已来
        
      </div>
    </a>
  
  
    <a href="/2025/12/23/Dubbo-%E5%85%A8%E8%A7%A3%E6%9E%90%EF%BC%9A%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">Dubbo 全解析：从入门到精通的分布式服务框架实战指南</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/">技术笔记</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSH/" rel="tag">SSH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E6%8B%89%E5%8F%96/" rel="tag">代码拉取</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E7%AB%A0%EF%BC%8C%E5%8D%9A%E5%AE%A2%E6%A1%86%E6%9E%B6%EF%BC%8C%E6%8A%80%E6%9C%AF/" rel="tag">文章，博客框架，技术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E6%B8%B8%E6%88%8F/" rel="tag">服务器，游戏</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE/" rel="tag">权限配置</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" rel="tag">编程语言</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E6%8B%89%E5%8F%96/" style="font-size: 10px;">代码拉取</a> <a href="/tags/%E6%96%87%E7%AB%A0%EF%BC%8C%E5%8D%9A%E5%AE%A2%E6%A1%86%E6%9E%B6%EF%BC%8C%E6%8A%80%E6%9C%AF/" style="font-size: 10px;">文章，博客框架，技术</a> <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E6%B8%B8%E6%88%8F/" style="font-size: 10px;">服务器，游戏</a> <a href="/tags/%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE/" style="font-size: 10px;">权限配置</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" style="font-size: 10px;">编程语言</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/12/">十二月 2025</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/12/25/gitLaB%E9%97%AE%E9%A2%98/">gitLaB问题</a>
          </li>
        
          <li>
            <a href="/2025/12/24/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/">大模型微调</a>
          </li>
        
          <li>
            <a href="/2025/12/24/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%8A%80%E6%9C%AF%E9%87%8C%E9%9D%A2%E7%9A%84%E2%80%98mcp%E2%80%99%E6%8A%80%E6%9C%AF/">计算机技术里面的‘mcp’技术</a>
          </li>
        
          <li>
            <a href="/2025/12/24/2025-8-19/">2025-8-19</a>
          </li>
        
          <li>
            <a href="/2025/12/24/%E9%82%A3%E4%BA%9B%E5%9C%A8%E5%85%AC%E5%8F%B8%E5%B7%A5%E4%BD%9C%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84-%E8%B6%85%E7%BA%A7%E9%BB%84%E9%87%91-bug-%EF%BC%9A%E6%AF%8F%E4%B8%AA%E7%A8%8B%E5%BA%8F%E5%91%98%E9%83%BD%E8%AF%A5%E8%AE%B0%E5%8F%96%E7%9A%84%E8%A1%80%E6%B3%AA%E7%BB%8F%E9%AA%8C/">那些在公司工作中遇到的 &#39;超级黄金 bug&#39;：每个程序员都该记取的血泪经验</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 little chen<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>